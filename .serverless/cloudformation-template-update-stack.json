{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "The AWS CloudFormation template for this Serverless application",
  "Resources": {
    "ServerlessDeploymentBucket": {
      "Type": "AWS::S3::Bucket"
    },
    "service": {
      "service": {
        "Type": "AWS::ECS::Service",
        "Properties": {
          "Cluster": "arn:aws:ecs:ap-southeast-2:005213230316:cluster/vtha-ECSCluster-11NSGX52FXRSZ",
          "DesiredCount": 1,
          "LoadBalancers": [],
          "Role": {
            "Ref": "serviceELBRole"
          },
          "TaskDefinition": {
            "Ref": "serviceTaskDefinition"
          }
        }
      },
      "serviceELBRole": {
        "Type": "AWS::IAM::Role",
        "Properties": {
          "AssumeRolePolicyDocument": {
            "Statement": [
              {
                "Effect": "Allow",
                "Principal": {
                  "Service": [
                    "ecs.amazonaws.com"
                  ]
                },
                "Action": [
                  "sts:AssumeRole"
                ]
              }
            ]
          },
          "Path": "/",
          "Policies": [
            {
              "PolicyName": "serviceELBRole",
              "PolicyDocument": {
                "Statement": [
                  {
                    "Effect": "Allow",
                    "Resource": "*",
                    "Action": [
                      "elasticloadbalancing:DeregisterInstancesFromLoadBalancer",
                      "elasticloadbalancing:DeregisterTargets",
                      "elasticloadbalancing:Describe*",
                      "elasticloadbalancing:RegisterInstancesWithLoadBalancer",
                      "elasticloadbalancing:RegisterTargets",
                      "ec2:Describe*",
                      "ec2:AuthorizeSecurityGroupIngress"
                    ]
                  }
                ]
              }
            }
          ]
        }
      },
      "serviceTaskDefinition": {
        "Type": "AWS::ECS::TaskDefinition",
        "Properties": {
          "Family": {
            "Fn::Sub": "${AWS::StackName}-task"
          },
          "ContainerDefinitions": [
            {
              "Name": "hello",
              "Essential": "true",
              "Image": "005213230316.dkr.ecr.ap-southeast-2.amazonaws.com/serverlecs:service-hello-1483064358",
              "Memory": 128,
              "PortMappings": [
                {
                  "ContainerPort": 3000
                }
              ],
              "LogConfiguration": {
                "LogDriver": "awslogs",
                "Options": {
                  "awslogs-group": {
                    "Ref": "serviceCloudwatchLogGroup"
                  },
                  "awslogs-region": {
                    "Ref": "AWS::Region"
                  },
                  "awslogs-stream-prefix": {
                    "Ref": "AWS::StackName"
                  }
                }
              }
            }
          ]
        }
      },
      "serviceCloudwatchLogGroup": {
        "Type": "AWS::Logs::LogGroup",
        "Properties": {
          "LogGroupName": {
            "Fn::Sub": "service-${AWS::StackName}"
          },
          "RetentionInDays": 7
        }
      }
    }
  },
  "Outputs": {
    "ServerlessDeploymentBucketName": {
      "Value": {
        "Ref": "ServerlessDeploymentBucket"
      }
    }
  }
}